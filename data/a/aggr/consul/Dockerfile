FROM aggr/ubuntu:trusty  
  
MAINTAINER Mikhail Baykov <mike@baikov.com>  
  
ENV CONSUL_VERSION 0.6.4  
ENV CONSUL_SHA256
abdf0e1856292468e2c9971420d73b805e93888e006c76324ae39416edcf0627  
  
ENV CONSUL_ACL_DATACENTER ""  
ENV CONSUL_ACL_DEFAULT_POLICY ""  
ENV CONSUL_ACL_DOWN_POLICY ""  
ENV CONSUL_ACL_MASTER_TOKEN ""  
ENV CONSUL_ACL_TOKEN ""  
ENV CONSUL_ACL_TTL ""  
ENV CONSUL_ADDRESSES_DNS ""  
ENV CONSUL_ADDRESSES_HTTP ""  
ENV CONSUL_ADDRESSES_HTTPS ""  
ENV CONSUL_ADDRESSES_RPC ""  
ENV CONSUL_ADVERTISE_ADDR ""  
ENV CONSUL_ADVERTISE_ADDR_WAN ""  
ENV CONSUL_ATLAS_ACL_TOKEN ""  
ENV CONSUL_ATLAS_INFRASTRUCTURE ""  
ENV CONSUL_ATLAS_JOIN ""  
ENV CONSUL_ATLAS_TOKEN ""  
ENV CONSUL_ATLAS_ENDPOINT ""  
ENV CONSUL_BOOTSTRAP ""  
ENV CONSUL_BOOTSTRAP_EXPECT ""  
ENV CONSUL_BIND_ADDR ""  
ENV CONSUL_CHECK_UPDATE_INTERVAL ""  
ENV CONSUL_CLIENT_ADDR ""  
ENV CONSUL_DATACENTER ""  
ENV CONSUL_DATA_DIR ""  
ENV CONSUL_DISABLE_ANONYMOUS_SIGNATURE ""  
ENV CONSUL_DISABLE_REMOTE_EXEC ""  
ENV CONSUL_DISABLE_UPDATE_CHECK ""  
ENV CONSUL_DNS_ALLOW_STALE ""  
ENV CONSUL_DNS_ENABLE_TRUNCATE ""  
ENV CONSUL_DNS_MAX_STALE ""  
ENV CONSUL_DNS_NODE_TTL ""  
ENV CONSUL_DNS_ONLY_PASSING ""  
ENV CONSUL_DNS_SERVICE_TTL ""  
ENV CONSUL_DOMAIN ""  
ENV CONSUL_ENCRYPT ""  
ENV CONSUL_HTTP_API_RESPONSE_HEADERS ""  
ENV CONSUL_LEAVE_ON_TERMINATE ""  
ENV CONSUL_NODE_NAME ""  
ENV CONSUL_PORTS_DNS ""  
ENV CONSUL_PORTS_HTTP ""  
ENV CONSUL_PORTS_HTTPS ""  
ENV CONSUL_PORTS_RPC ""  
ENV CONSUL_PORTS_SERF_LAN ""  
ENV CONSUL_PORTS_SERF_WAN ""  
ENV CONSUL_PORTS_SERVER ""  
ENV CONSUL_PROTOCOL ""  
ENV CONSUL_REAP ""  
ENV CONSUL_RECURSORS ""  
ENV CONSUL_REJOIN_AFTER_LEAVE ""  
ENV CONSUL_RETRY_JOIN ""  
ENV CONSUL_RETRY_INTERVAL ""  
ENV CONSUL_RETRY_JOIN_WAN ""  
ENV CONSUL_RETRY_INTERVAL_WAN ""  
ENV CONSUL_SERVER ""  
ENV CONSUL_SERVER_NAME ""  
ENV CONSUL_SESSION_TTL_MIN ""  
ENV CONSUL_SKIP_LEAVE_ON_INTERRUPT ""  
ENV CONSUL_START_JOIN ""  
ENV CONSUL_START_JOIN_WAN ""  
ENV CONSUL_TELEMETRY_STATSD_ADDR ""  
ENV CONSUL_TELEMETRY_STATSITE_ADDR ""  
ENV CONSUL_TELEMETRY_STATSITE_PREFIX ""  
ENV CONSUL_TELEMETRY_DOGSTATSD_ADDR ""  
ENV CONSUL_TELEMETRY_DOGSTATSD_TAGS ""  
ENV CONSUL_TELEMETRY_DISABLE_HOSTNAME ""  
ENV CONSUL_TRANSLATE_WAN_ADDRS ""  
ENV CONSUL_TLS_CA_FILE ""  
ENV CONSUL_TLS_CERT_FILE ""  
ENV CONSUL_TLS_KEY_FILE ""  
ENV CONSUL_TLS_VERIFY_INCOMING ""  
ENV CONSUL_TLS_VERIFY_OUTGOING ""  
ENV CONSUL_TLS_VERIFY_SERVER_HOSTNAME ""  
ENV CONSUL_UI ""  
ENV CONSUL_UI_DIR ""  
ENV CONSUL_SOCKETS_USER ""  
ENV CONSUL_SOCKETS_GROUP ""  
ENV CONSUL_SOCKETS_MODE ""  
# Avoid ERROR: invoke-rc.d: policy-rc.d denied execution of start.  
RUN echo "#!/bin/sh\nexit 0" > /usr/sbin/policy-rc.d  
  
RUN apt-get -qqy update && DEBIAN_FRONTEND=noninteractive && apt-get -qqy
upgrade && apt-get -qqy install jq curl && mkdir /config  
ADD
https://releases.hashicorp.com/consul/${CONSUL_VERSION}/consul_${CONSUL_VERSION}_linux_amd64.zip
/tmp/consul.zip  
RUN echo "${CONSUL_SHA256} /tmp/consul.zip" > /tmp/consul.sha256 \  
&& sha256sum -c /tmp/consul.sha256 \  
&& cd /bin \  
&& unzip /tmp/consul.zip \  
&& chmod +x /bin/consul \  
&& rm /tmp/consul.zip  
  
ADD consul_launcher /bin/  
RUN chmod +x /bin/consul_launcher  
  
ENTRYPOINT ["/bin/consul_launcher"]  

