FROM ubuntu:xenial-20171006  
  
RUN echo "deb http://ag-projects.com/ubuntu xenial main" >>
/etc/apt/sources.list  
  
RUN apt-get update -qq && \  
apt-get install -y --allow-unauthenticated --no-install-recommends \  
build-essential \  
ca-certificates \  
curl \  
libgsm1-dev \  
libspeex-dev \  
libspeexdsp-dev \  
libsrtp0-dev \  
libssl-dev \  
locales \  
portaudio19-dev \  
python \  
python-dev \  
python-pip \  
python-virtualenv \  
libasound2-dev \  
python-sipsimple \  
sipclients \  
&& locale-gen en_US.UTF-8 && \  
apt-get purge -y --auto-remove && rm -rf /var/lib/apt/lists/*  
  
# The /etc/default/locale file, generated by update-locale, is loaded by PAM;  
# see /etc/pam.d/login for example. However, PAM is not invoked when running  
# a command in a Docker container.  
ENV LANG=en_US.UTF-8 \  
LANGUAGE=en_US:en \  
LC_ALL=en_US.UTF-8  
  
ENV PJSIP_VERSION=2.5.5  
RUN mkdir /usr/src/pjsip && \  
cd /usr/src/pjsip && \  
curl -vsL
http://www.pjsip.org/release/${PJSIP_VERSION}/pjproject-${PJSIP_VERSION}.tar.bz2
| \  
tar --strip-components 1 -xj && \  
CFLAGS="-O2 -DNDEBUG" ./configure --enable-shared \  
\--disable-sound \  
# --disable-opencore-amr \  
# --disable-resample \  
# --disable-video \  
# --with-external-gsm \  
# --with-external-pa \  
# --with-external-speex \  
# --with-external-srtp \  
\--prefix=/usr && \  
make all install && \  
/sbin/ldconfig && \  
cd /usr/src/pjsip/pjsip-apps/src/python && python setup.py build && python
setup.py install && \  
rm -rf /usr/src/pjsip  

